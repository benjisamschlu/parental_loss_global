---
title: "Parental loss from a global perspective"
author:
  - name: Benjamin-Samuel Schl√ºter
    affiliation: A
    footnote:
      - corresp
  - name: Antonino Polizzi
    affiliation: B 
  - name: Diego Alburez-Gutierrez
    affiliation: C
  - name: Monica Alexander
    affiliation: D
address:
  - code: A
    address: Department of Statistical Sciences, University of Toronto, Canada
  - code: B
    address: Leverhulme Centre for Demographic Science, University of Oxford, England
  - code: C
    address: Max Planck Institute for Demographic Research, Germany
  - code: D
    address: Departments of Statistical Sciences and Sociology, University of Toronto, Canada
footnote:
  - code: corresp
    text: "benjamin.schluter@utoronto.ca."
bibliography: refs.bib
csl: demographic-research.csl
link-citations: TRUE
output:
  bookdown::pdf_document2:
    toc: FALSE
    keep_tex: TRUE
    template: generic_article_template.tex
    #md_extensions: "-autolink_bare_uris"
    number_sections: TRUE
    citation_package: default # Can also be "natbib"
geometry: "margin=25mm"
papersize: letter
fontsize: 11pt
endfloat: FALSE # Set to TRUE to turn on latex endfloat package to place figures and tables at end of document
numberlines: FALSE
authblk: TRUE # FALSE = author affiliations in footnotes; TRUE = author affiliations in a block below author names
footnotehyper: FALSE # TRUE will give you enhanced table footnote capabilities. Set to FALSE to be able to use French blocks. Needed due to what appears to be a latex bug.
urlcolor: blue
linkcolor: blue
citecolor: blue
graphics: TRUE # Needed to be able to include images
tables: TRUE # Needed to be able to include tables
always_allow_html: true
abstract: "150 words"
---



```{r chunk-options, echo=FALSE}

## Global chunk options --------------------------------------------------------

knitr::opts_chunk$set(echo = FALSE)

```


```{r pkg-data, warning=FALSE, message=FALSE}

## Load packages ---------------------------------------------------------------

## Install/load packages
packages <- c("tidyverse", "ggplot2", "here", "viridis")
for(p in packages){
    if(!require(p,character.only = TRUE)) install.packages(p)
    library(p,character.only = TRUE)
}



## Functions -------------------------------------------------------------------

## Script containing the functions computing
## the main elements required to run the kin dynamics



## Load data -------------------------------------------------------------------

df_birth = readRDS(here("data", "df_birth_example_countries.rda"))

df_results <- readRDS(here("data", "df_results.rda")) |> 
  mutate(
    ## Improve plotting
    ctry = ifelse(ctry == "United States of America", "USA", ctry),
    sex = ifelse(sex == "mother", "Mother", "Father")
    )  |> 
  ## Having four countries makes the plotting easier
  filter(ctry != "Germany")



## Key dimensions --------------------------------------------------------------
 
countries <- unique(df_results$ctry)

```


```{r plot-theme}

## plot theme
theme_plot <- function() {
  
  theme_bw() +
    theme(
      ## legend
      legend.position = "top",
      legend.title = element_text(size = 8),
      legend.text = element_text(size = 7),
      
      ## axes
      axis.title = element_text(size = 10),
      axis.text = element_text(size = 9),
      
      ## facets
      strip.background=element_blank(),
      strip.text = element_text(face = "bold", size = 8),
      panel.border = element_blank(),
      axis.line = element_line(color = 'black')
      )
}

```


# Introduction



# Data and Method

Two sources of data were needed in order to estimate the worldwide parental loss by cause of death: cause-specific mortality, and life table data with its associated population counts, fertility rates and birth counts.

Period *life table data* by 1-year age class (0, 1, 2, ..., 100+) and sex, grouped in one calendar year were obtained from the UN world population prospects [@united2022world]. All the life table functions (e.g. age-specific probabilities of dying and surviving) were retrieved from this data source. Yearly age-specific *fertilty rates* for females aged 15 to 49 years old and *population counts* by 1-year age group and sex were also obtained from this source. 

*Cause of death* information was obtained from modeled data from the @ihme2019gbd. Cause of death information was collected from this source for ages 0, 1-4, and then in five-year age groups until the open age-group 95 and more. We converted these counts into 1-year age group until age 100+, using a penalized composite link model [@rizzi2015efficient]. Twenty-two causes of death were selected corresponding to the level two of the GBD hierarchy of causes.

We used the kinship matrix model [@caswell2019formal] where the projected kin was the parent (mother and father).  
The model combined several extensions to use time-varying and sex-differentiated vital rates while accounting for death from multiple causes [@caswell2021formal; @caswell2022formal; @caswell2023formal]. The parents' dynamics can be expressed as follows

$$\begin{pmatrix} \boldsymbol{d}^f_L \\ 
\boldsymbol{d}^m_L \\ 
\hline \boldsymbol{d}^f_D \\ 
\boldsymbol{d}^m_D 
\end{pmatrix}(x+1, t+1) = 
\left(\begin{array}{@{}c|c@{}}
  \begin{matrix} 
  \boldsymbol{U}^f_t & \boldsymbol{0} \\ 
  \boldsymbol{0} & \boldsymbol{U}^m_t 
  \end{matrix} & \boldsymbol{0} \\
\hline
\begin{matrix} 
  \boldsymbol{M}^f_t & \boldsymbol{0} \\ 
  \boldsymbol{0} & \boldsymbol{M}^m_t 
  \end{matrix} & \boldsymbol{0} \\
\end{array}\right)
\begin{pmatrix} \boldsymbol{d}^f_L \\ 
\boldsymbol{d}^m_L \\ 
\hline \boldsymbol{d}^f_D \\ 
\boldsymbol{d}^m_D
\end{pmatrix}(x, t)$$

where the matrix $\boldsymbol{U}_t$ of dimension $(\omega \times \omega)$ contains the survival probabilities on its main subdiagonal; the matrix $\boldsymbol{M}_t$ of dimension $(\alpha\omega \times \omega)$ contains the probabilities of dying from the causes considered on its main diagonals; $\boldsymbol{d}_L$ refers to the age distribution of the parent living and $\boldsymbol{d}_D$ reflects the age distribution of the parent dying by cause, in year $t$ when a child is aged $x$; upper scripts $f$ and $m$ corresponds to female and male, respectively; subscript $t$ refers to the year; $\omega=101$ which was the number of ages considered and $\alpha=22$ as we considered twenty-two different causes of death. The block matrix on the right-hand side allows to project the parents' age distribution (alive or dead) over time, as their child ages. The model is fit on each country separately.  
The model requires as input the age distribution of parents of offspring (see @caswell2021formal for more details). We assumed that in a given year $t$, both parents were alive at the time of birth and the age distribution of parents at the birth of their child (when $x=0$) is expressed as $\boldsymbol{\pi_t} = \frac{\boldsymbol{f}_t \circ \boldsymbol{n}_t}{||\boldsymbol{f}_t \circ \boldsymbol{n}_t||}$, where $\boldsymbol{f}_t$ is a vector of dimension $(\omega \times 1)$ containing age-specific fertility rates and $\boldsymbol{n}_t$ is a vector of dimension $(\omega \times 1)$ being the age distribution of the overall population. Hence, at the birth of a child in year $t$, 

$$\begin{pmatrix} \boldsymbol{d}^f_L \\ 
\boldsymbol{d}^m_L \\ 
\hline \boldsymbol{d}^f_D \\ 
\boldsymbol{d}^m_D 
\end{pmatrix}(0, t)
=
\begin{pmatrix} \boldsymbol{\pi_t}^f \\ 
\boldsymbol{\pi_t}^m \\ 
\hline \boldsymbol{0} \\ 
\boldsymbol{0} 
\end{pmatrix}
$$

We assumed that female and male age-specific fertility rates were equal as the UN does not provide male fertility. 
Cause-specific mortality was not available for the period 1950-1990. During this period, we simplified the block-matrix to only contain survival probabilities, meaning that we only projected the age distribution of parents alive before 1990 ($\boldsymbol{M}_t = \boldsymbol{0}$ for $t < 1990$). We additionally recorded the age distribution of parents dying by cause from 1990 onward. As it is commonly done in these models, before 1950, we assumed that the earliest available rates have been operating for a long time (stable population assumption). 

Two metrics - obtained using outputs from the parents' dynamics - were of particular interest. First, the probability of bereavement of a randomly selected child in the population was approximated by

$$\text{Prob.(losing at least one parent)}(x,t)=1-(1-d_t/2)^2$$

where $d_t$ represents the mean number of dead parent at age $x$ of their child in year $t$ [@caswell2023formal].  
Second, the percentage of born children aged less than 18 years old losing a parent in year $t$ ($PCLP_t$). We computed it as follows

$$PCLP_t = \frac{\sum^{17}_{x=0}(l_{x,t} \cdot B_t) \cdot \text{Prob.(losing at least one parent)}(x,t)}{B_t}$$

where $l_{x,t}$ corresponds to the fraction of the hypothetical cohort surviving to age $x$ in the period life table for both sex combined in year $t$ (using the same data as for $\boldsymbol{U_t}$ but not differentiating by sex); and $B_t$ is the number of births in year $t$. This metric can also be made cause-specific by replacing $\text{Prob.(losing at least one parent)}(x,t)$ by $\text{Prob.(losing at least one parent due to cause i)}(x,t)$. 



# Preliminary Results

* Percentages always higher for father relative to mother (Fig. \@ref(fig:perc-ber-all)).

* Recent increase in Afghanistan driven by violent death (Fig. \@ref(fig:perc-ber-all)-\@ref(fig:perc-ber-top)).

* HIV epidemics visible for Zimbabwe (Fig. \@ref(fig:perc-ber-all)-\@ref(fig:perc-ber-top)).

```{r perc-ber-all, message=FALSE, warning=FALSE, fig.cap="Percentage of children losing a parent, by parent sex and country over period 1970-2019"}

## cod data available from year 1990
## !! years 1950  to 1990, assumed causes where
## having equal prob of dying !!
df_results |> 
  filter(
    ## assume stable population in 1950 but focus on children 
    ## aged < 18 yo, so good to focus on years > 1968
    year >= 1970,
    ## model assumes parent alive at birth of child
    age > 0,
    ## focus on children aged < 18
    age < 18
  ) |>
  ## Sum prop of born children losing parent from 
  ## all different causes over ages 1 to 17 yo
  group_by(
    sex, year, ctry
  ) |> 
  summarise(
    perc = sum(perc)
  ) |> 
  ungroup() |> 
  ggplot(aes(x = year, y = perc, col = ctry)) +
  facet_wrap(~ sex) +
  geom_line(linewidth = 1) +
  theme_plot() + 
  theme(legend.title = element_blank(),
        axis.title.x = element_blank()) +
  labs(y = "% bereaved children",
       x = "Year")

```

* Afghanistan and Mexico: top three parental causes of death vary between mother and father (Fig. \@ref(fig:perc-ber-top)).

* Global South: general downward trend except for father due to violent death in Mexico and Afghanistan, and HIV in Zimbabwe (Fig. \@ref(fig:perc-ber-top)). 

```{r perc-ber-top, message=FALSE, warning=FALSE, fig.cap="Percentage of children losing a parent, by parent sex and country top three causes of parental death over period 1990-2019"}

## nber of causes considered
top.n <- 3

## causes killing the most parent 
## for children aged < 18 yo
main.causes <- sapply(countries, function(c) {
  
  df_results |> 
    filter(
      ## CoD data from 1990
      year >= 1990,
      ## model assumes parent alive at birth of child
      age > 0,
      ## focus on children aged < 18
      age < 18,
      ## looping on country
      ctry == c
    ) |>
    ## Sum prop of born children losing parent by
    ## causes over ages 1 to 17 yo
    group_by(
      sex, cause
    ) |> 
    summarise(
      N = sum(N)
    ) |> 
    arrange(
      sex, desc(N)
    ) |> 
    group_by(
      sex
    ) |> 
    slice_max(
      order_by = N,
      n = top.n
    )
}, 
simplify = FALSE,
USE.NAMES = TRUE
)

## Remove repetition of causes
causes <- unique(do.call("rbind", main.causes)$cause)

## Associate a color to a cause
cols <- c("cornflowerblue", "cadetblue2", "deepskyblue", 
          "darkorange1", "coral4", "red2",
          "yellow2", "darkgrey", "blue4")
names(cols) <- causes

## Extract legend corresponding to the main causes of death
## found across the different countries (don't care about plot
## in itself)
plot_legend <- df_results |> 
  filter(cause %in% causes) |> 
  ggplot(aes(x = year, y = perc, col = cause)) + 
  facet_grid(ctry ~ sex) +
  geom_line(linewidth = 2) +
  theme_bw() +
  scale_color_manual(values = cols) +
  labs(col = "Parental cause of death") +
  guides(col=guide_legend(ncol=2))

common.legend <- cowplot::get_legend(plot_legend)

## Store plot in a list
list.fig.share.by.cause <- lapply(countries, function(c) {
  
  df_results |> 
    filter(
      ## CoD data from 1990
      year >= 1990,
      ## model assumes parent alive at birth of child
      age > 0,
      ## focus on children aged < 18
      age < 18,
      ## looping on country
      ctry == c,
      ## filtering main causes of death of each country by sex
      (sex == "Mother" & cause %in% main.causes[[c]]$cause[main.causes[[c]]$sex == "Mother"]) |
        (sex == "Father" & cause %in% main.causes[[c]]$cause[main.causes[[c]]$sex == "Father"])
    ) |>
    ## Sum prop of born children losing parent from 
    ## all different causes over ages 1 to 17 yo
    group_by(
      sex, year, cause
    ) |> 
    summarise(
      perc = sum(perc)
    ) |> 
    ungroup() |> 
    ggplot(aes(x = year, y = perc, col = cause)) +
    facet_wrap(~ sex) +
    geom_line(linewidth = 1) +
    theme_plot() + 
    theme(legend.position = "none",
          panel.spacing = unit(0.35, "cm"),
        axis.title.x = element_blank()) +
    scale_color_manual(values = cols) +
    scale_x_continuous(breaks = c(seq(1990, 2005, 15), 2019),
                       limits = c(1990, 2020)) +
    labs(y = "% bereaved children")
  
}) 

## plot of countries
fig <- cowplot::plot_grid(plotlist = list.fig.share.by.cause,
                          labels = countries,
                          label_size = 11,
                          label_x = 0.55,
                          hjust = 0.5,
                          ncol = 2)
## final plot adding the legend
cowplot::plot_grid(fig, 
                   common.legend,
                   ncol = 1,
                   rel_heights = c(2,1)
)

```

* Difference in the level of bereavement probability (Fig. \@ref(fig:ber-prob)).

* Difference in the mix of causes between the two countries (Fig. \@ref(fig:ber-prob)).

* Self-harm and transport injuries kill parents when their child are young (Fig. \@ref(fig:ber-prob)). 

```{r ber-prob, message=FALSE, warning=FALSE, fig.cap="Age- and cause-specific bereavement probabilities of losing at least one parent, by country top twelve causes in 2019"}

ex.countries <- c("Mexico", "Afghanistan")
ex.year <- 2019
big.causes <- c("Cardiovascular diseases",
                "Neoplasms")
## nber of causes considered
top.n <- 10

## causes killing the most parent 
## for children aged < 18 yo
main.causes <- sapply(ex.countries, function(c) {
  
  df_results |> 
    filter(
      ## model assumes parent alive at birth of child
      age > 0,
      ctry == c,
      year == 2019,
      !(cause %in% big.causes)
    ) |>
    ## Get outputs for both parents combined
    ## (= losing at least one parent)
    ## Sum death over parent sex
    group_by(
      ctry, year, cause, age
    ) |>
    summarise(
      N = sum(N)
    ) |> 
    ungroup() |> 
    mutate(
      ## Bereavement prob of losing >= 1 parent
      prob_ber = 1 - (1 - (N / 2))^2
    ) |> 
    group_by(cause) |> 
    summarise(prob_ber = sum(prob_ber)) |> 
    ungroup() |> 
    slice_max(
      order_by = prob_ber,
      n = top.n
    )
}, 
simplify = FALSE,
USE.NAMES = TRUE
)

## Remove repetition of causes
causes <- unique(do.call("rbind", main.causes)$cause)

## Associate a color to a cause
cols <- c("black", "lightgray",
          "cornflowerblue", "cadetblue2", "deepskyblue", 
          "darkorange1", "coral4", "red2", "pink",
          "yellow2", "darkgrey", "blue4",
          "blueviolet", "darkslategray")
names(cols) <- c(big.causes, sort(as.character(causes)))


df_results |> 
  filter(
    ## model assumes parent alive at birth of child
    age > 0,
    ctry %in% ex.countries,
    year == 2019
  ) |>
  ## Get outputs for both parents combined
  ## (= losing at least one parent)
  ## Sum death over parent sex
  group_by(
    ctry, year, cause, age
  ) |>
  summarise(
    N = sum(N)
  ) |> 
  ungroup() |> 
  mutate(
    ## Bereavement prob of losing >= 1 parent
    prob_ber = 1 - (1 - (N / 2))^2,
    ## Separate causes of death
    cause.gp = case_when(
      cause %in% big.causes ~ "Cardiovascular + Neoplasms",
      TRUE ~ "Top 10 causes"
    ),
    ## Order causes for plot
    cause = factor(
      cause,
      levels = names(cols),
      labels = names(cols)
    )
  ) |> 
  ggplot(aes(x = age, y = prob_ber, fill = cause)) +
  facet_grid(cause.gp ~ ctry) +
  geom_area(alpha = .9, color = "white") +
  theme_plot() +
  theme(legend.position = "right") +
  scale_fill_manual(values = cols) +
  labs(y = "Cause-specific prob. of losing at least one parent",
       x = "Child's life course (age in years)", 
       fill = "Parental cause of death")
  

```


# Next Steps & Extensions

* All countries

* Uncertainty measures using posterior draws/95% credible intervals

* Validation with empirical data on US and Mexico

* Projection using UN WPP projection estimates

* Improve assumption about fertility of males


\newpage


# References {-}

<div id="refs"></div>
